# [クラス名/関数名] 単体テスト仕様書

## 1. テスト目的

このテストで検証する主要な挙動を簡潔に記述します。
例：`Variable` クラスの逆伝播において、同じ変数が複数回使用された場合に勾配が正しく合算されることを確認する。

## 2. テスト対象クラス・メソッド

| 対象クラス | 対象メソッド | 確認内容の要約 |
| --- | --- | --- |
| `Variable` | `backward` | 複雑な計算グラフでの勾配計算の正確性 |
| `Add` | `forward / backward` | 加算の順伝播・逆伝播ロジック |

## 3. テストケース定義

具体的な入力値と、期待される出力（または挙動）を整理します。

### 3.1 正常系テスト (Normal Cases)

| ID | テストケース名 | 入力値 (Input) | 期待される結果 (Expected) | 検証方法 |
| --- | --- | --- | --- | --- |
| N-01 | 基本的な逆伝播 | `x = Variable(np.array(2.0))` | `x.grad == 1.0` (y=xの場合) | `assertEqual` |
| N-02 | 勾配の合算 | `y = add(x, x)` | `x.grad == 2.0` | `np.testing.assert_allclose` |
| N-03 | 世代順の実行 | 複雑な分岐グラフ | 世代の大きい順に関数が呼ばれる | 実行順序のログ確認 |

### 3.2 境界値・異常系テスト (Edge/Exception Cases)

| ID | テストケース名 | 入力値 (Input) | 期待される結果 (Expected) | 備考 |
| --- | --- | --- | --- | --- |
| E-01 | スカラー以外 | `np.array([1, 2])` | エラーにならず計算されること | ブロードキャストの確認 |
| E-02 | 初期勾配なし | `grad`が`None`の状態で`backward` | 自動的に`1.0`で初期化される |  |

## 4. 数値微分による検証 (Gradient Check)

ディープラーニングの実装特有の検証項目です。

* **検証方法**: 手動で実装した `backward` の値と、`numerical_diff`（数値微分）で得た値を比較する。
* **許容誤差**: `1e-5` 程度。

## 5. テストコード実装上の注意

* **共通セットアップ**: `setUp` メソッドで `Config.enable_backprop = True` を設定する。
* **クリーンアップ**: 大規模なテストデータを使用する場合は `tearDown` でメモリを解放する。

